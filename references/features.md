# 機能一覧

画像からテキストを抽出するOCRアプリケーションの実装機能リスト

---

## 1. 画像アップロード機能

### 1.1 ファイル選択機能
- [ ] ファイル選択ダイアログからの画像選択
- [ ] ドラッグ&ドロップでの画像アップロード
- [ ] 対応フォーマット: JPEG, PNG, PDF, TIFF, BMP

### 1.2 画像プレビュー機能
- [ ] アップロード前の画像プレビュー表示
- [ ] 画像サイズ・ファイル名の表示
- [ ] プレビューのクリア機能

### 1.3 ファイル検証機能
- [ ] ファイルサイズの検証 (最大10MB)
- [ ] ファイル拡張子のホワイトリスト検証
- [ ] MIMEタイプの検証
- [ ] 画像の破損チェック

---

## 2. OCR処理機能

### 2.1 Azure Document Intelligence連携
- [ ] DocumentAnalysisClient の初期化
- [ ] エンドポイントとキーの設定管理
- [ ] Read モデルを使用したテキスト抽出
- [ ] API呼び出しの非同期処理

### 2.2 テキスト抽出処理
- [ ] 印刷テキストの抽出
- [ ] 手書きテキストの抽出
- [ ] 複数ページの処理 (PDF対応)
- [ ] 言語の自動検出または指定

### 2.3 結果データの構造化
- [ ] テキスト行ごとの情報抽出
- [ ] バウンディングボックス情報の取得
- [ ] 信頼度スコアの取得
- [ ] ページ番号の管理

---

## 3. 結果表示機能

### 3.1 テキスト表示
- [ ] 抽出されたテキスト全体の表示
- [ ] 行ごとの詳細表示（UIモックの右側の領域）
- [ ] 読みやすいフォーマット

### 3.2 インタラクティブ機能
- [ ] テキストのコピー機能
- [ ] 結果のクリア/リセット機能
- [ ] 新しい画像の処理

### 3.3 詳細情報表示
- [ ] 信頼度スコアの表示
- [ ] 検出された言語の表示
- [ ] ページ数の表示（複数ページの場合）

---

## 4. UI/UX機能

### 4.1 レスポンシブデザイン
- [ ] デスクトップ対応
- [ ] タブレット対応
- [ ] モバイル対応

### 4.2 進行状況表示
- [ ] アップロード中のプログレス表示
- [ ] OCR処理中のローディング表示
- [ ] 処理完了の通知

### 4.3 ユーザーフィードバック
- [ ] 成功メッセージの表示
- [ ] エラーメッセージの表示
- [ ] 警告メッセージの表示

### 4.4 アクセシビリティ
- [ ] キーボード操作対応
- [ ] スクリーンリーダー対応
- [ ] ARIA属性の実装

---

## 5. セキュリティ機能

### 5.1 入力検証
- [ ] ファイルサイズ制限の実施
- [ ] ファイル形式の検証
- [ ] ファイル名のサニタイゼーション
- [ ] 危険なファイルの拒否

### 5.2 CSRF対策
- [ ] AntiForgeryトークンの生成
- [ ] トークン検証の実装
- [ ] すべてのPOSTリクエストでの検証

### 5.3 シークレット管理
- [ ] User Secrets の設定（開発環境）
- [ ] 環境変数からの読み込み
- [ ] Azure Key Vault 連携（本番環境用）

### 5.4 セキュアな通信
- [ ] HTTPS通信の強制
- [ ] セキュアヘッダーの設定
- [ ] HSTS の有効化

---

## 6. エラーハンドリング機能

### 6.1 クライアントサイド
- [ ] ネットワークエラーの処理
- [ ] ファイル検証エラーの表示
- [ ] タイムアウトの処理

### 6.2 サーバーサイド
- [ ] Azure API エラーの処理
- [ ] レート制限エラーの処理
- [ ] 一般的な例外の処理
- [ ] カスタムエラーレスポンスの返却

### 6.3 リトライ機能
- [ ] 一時的なエラーの自動リトライ
- [ ] 指数バックオフの実装
- [ ] 最大リトライ回数の設定

---

## 7. ロギング機能

### 7.1 アプリケーションログ
- [ ] 情報ログの記録
- [ ] エラーログの記録
- [ ] 警告ログの記録
- [ ] デバッグログの記録（開発環境）

### 7.2 構造化ログ
- [ ] Serilog の設定
- [ ] コンソール出力
- [ ] ファイル出力
- [ ] JSON形式でのログ出力

### 7.3 監視・診断
- [ ] 処理時間のログ記録
- [ ] API呼び出しのトレース
- [ ] エラー率の追跡

---

## 8. 設定管理機能

### 8.1 アプリケーション設定
- [ ] appsettings.json の設定
- [ ] 環境別設定（Development/Production）
- [ ] 設定値の検証

### 8.2 Azure設定
- [ ] Document Intelligence エンドポイント
- [ ] APIキーの管理
- [ ] リージョン設定

### 8.3 ファイルアップロード設定
- [ ] 最大ファイルサイズの設定
- [ ] 許可する拡張子の設定
- [ ] タイムアウト設定

---

## 9. サービス層機能

### 9.1 インターフェース定義
- [ ] `IOcrService` インターフェース
- [ ] 依存性注入の設定
- [ ] モックテスト用の抽象化

### 9.2 DocumentIntelligenceService実装
- [ ] `ExtractTextAsync` メソッド
- [ ] `ValidateImageAsync` メソッド
- [ ] バウンディングボックス変換メソッド
- [ ] エラーハンドリング

---

## 10. データモデル機能

### 10.1 モデルクラス
- [ ] `OcrResult` クラス
- [ ] `TextLine` クラス
- [ ] `ImageUploadRequest` クラス
- [ ] `OcrError` クラス
- [ ] `ImageProcessingOptions` クラス

### 10.2 データ検証
- [ ] データアノテーション
- [ ] カスタムバリデーション
- [ ] モデルバインディング

---

## 11. Razor Pages機能

### 11.1 Index ページ
- [ ] `Index.cshtml` のマークアップ
- [ ] `Index.cshtml.cs` のPageModel
- [ ] `OnGet` ハンドラー
- [ ] `OnPostUploadAsync` ハンドラー

### 11.2 共有レイアウト
- [ ] `_Layout.cshtml`
- [ ] `_ViewImports.cshtml`
- [ ] `_ViewStart.cshtml`
- [ ] ナビゲーションバー（必要に応じて）

---

## 12. JavaScript機能

### 12.1 OcrApp クラス
- [ ] クラスの初期化
- [ ] イベントリスナーの設定
- [ ] ドラッグ&ドロップハンドラー
- [ ] ファイル選択ハンドラー

### 12.2 API通信
- [ ] Fetch API の実装
- [ ] FormData の作成
- [ ] AntiForgeryトークンの取得と送信
- [ ] レスポンスの処理

### 12.3 UI更新
- [ ] プレビュー画像の表示
- [ ] 結果テキストの表示
- [ ] ローディング表示の制御
- [ ] エラーメッセージの表示

---

## 13. スタイリング機能

### 13.1 CSS設計
- [ ] カスタムCSS（site.css）
- [ ] Bootstrap 5 の統合
- [ ] レスポンシブグリッドシステム
- [ ] UIモックに基づいたデザイン

### 13.2 UI コンポーネント
- [ ] 入力フィールドのスタイル
- [ ] ボタンのスタイル（Submit）
- [ ] カードレイアウト
- [ ] アイコンの統合（Font Awesome）

---

## 14. コンテナ化機能

### 14.1 Docker設定
- [ ] Dockerfile の作成
- [ ] マルチステージビルド
- [ ] イメージの最適化
- [ ] ポート公開設定

### 14.2 Docker Compose
- [ ] docker-compose.yml の作成
- [ ] 環境変数の設定
- [ ] ボリュームマウント
- [ ] ネットワーク設定

### 14.3 環境変数管理
- [ ] .env ファイルの作成
- [ ] .env.example の提供
- [ ] .gitignore への追加

---

## 15. テスト機能

### 15.1 単体テスト
- [ ] DocumentIntelligenceService のテスト
- [ ] PageModel のテスト
- [ ] バリデーションロジックのテスト
- [ ] モックの実装

### 15.2 テストインフラ
- [ ] xUnit プロジェクトのセットアップ
- [ ] Moq の設定
- [ ] テストデータの準備

---

## 実装優先度

### 🔴 最優先（MVP - Minimum Viable Product）

実用最小限の機能として最初に実装すべき項目

#### フェーズ1: 基盤構築
- [ ] プロジェクト作成（ASP.NET Core Web App）
- [ ] 基本的なプロジェクト構造の作成
- [ ] NuGetパッケージのインストール
- [ ] Azure Document Intelligence リソースの作成

#### フェーズ2: コア機能
- [ ] `IOcrService` インターフェースの定義
- [ ] `DocumentIntelligenceService` の実装
- [ ] モデルクラスの作成（`OcrResult`, `TextLine`）
- [ ] Azure Document Intelligence 連携
- [ ] テキスト抽出処理の実装

#### フェーズ3: 基本UI
- [ ] `Index.cshtml` の作成
- [ ] `Index.cshtml.cs` (PageModel) の実装
- [ ] ファイル選択機能（input type="file"）
- [ ] 基本的な結果表示
- [ ] Submit ボタンの実装

#### フェーズ4: 最小限のエラーハンドリング
- [ ] サーバーサイドエラーハンドリング
- [ ] 基本的なクライアントサイドエラー表示
- [ ] ファイルサイズ検証
- [ ] ファイル形式検証

### 🟡 高優先度

MVPに次いで重要な機能

#### フェーズ5: UX向上
- [ ] ドラッグ&ドロップ機能
- [ ] 画像プレビュー表示
- [ ] 進行状況表示（ローディング）
- [ ] JavaScript (ocr-app.js) の実装
- [ ] Fetch API による非同期通信

#### フェーズ6: セキュリティ基盤
- [ ] CSRF対策（AntiForgeryトークン）
- [ ] ファイル名のサニタイゼーション
- [ ] MIMEタイプの検証
- [ ] User Secrets の設定

#### フェーズ7: ロギングと監視
- [ ] Serilog の設定
- [ ] エラーログの記録
- [ ] 処理時間のトレース
- [ ] コンソールとファイル出力

### 🟢 中優先度

品質とユーザビリティの向上

#### フェーズ8: UI/UX完成度向上
- [ ] レスポンシブデザイン
- [ ] Bootstrap 5 の統合
- [ ] カスタムCSS (site.css)
- [ ] UIモックに基づいた完全なデザイン実装

#### フェーズ9: 詳細機能
- [ ] テキストコピー機能
- [ ] 行ごとの詳細表示
- [ ] 信頼度スコア表示
- [ ] 言語検出表示
- [ ] ページ数表示

#### フェーズ10: エラーハンドリング強化
- [ ] リトライロジック
- [ ] レート制限エラーの処理
- [ ] タイムアウト処理
- [ ] カスタムエラーページ

#### フェーズ11: 品質保証
- [ ] 単体テストプロジェクトの作成
- [ ] DocumentIntelligenceService のテスト
- [ ] PageModel のテスト
- [ ] モックの実装

### 🔵 低優先度

拡張機能と最適化

#### フェーズ12: アクセシビリティ
- [ ] キーボード操作対応
- [ ] スクリーンリーダー対応
- [ ] ARIA属性の実装
- [ ] コントラスト比の確認

#### フェーズ13: コンテナ化
- [ ] Dockerfile の作成
- [ ] docker-compose.yml の作成
- [ ] 環境変数管理
- [ ] コンテナでの動作確認

#### フェーズ14: 高度なセキュリティ
- [ ] Azure Key Vault 連携
- [ ] セキュアヘッダーの設定
- [ ] HSTS の有効化
- [ ] 詳細な入力検証

#### フェーズ15: パフォーマンス最適化
- [ ] キャッシング戦略
- [ ] 画像の圧縮/リサイズ
- [ ] バンドル化と最小化
- [ ] CDN統合（必要に応じて）

---

## 機能の依存関係

### 必須の前提条件

```
Azure Document Intelligence リソース
  ↓
DocumentIntelligenceService
  ↓
PageModel (Index.cshtml.cs)
  ↓
Index.cshtml (UI)
```

### 推奨される実装順序

```
1. プロジェクト作成
   ↓
2. モデルクラス
   ↓
3. サービス層
   ↓
4. Azure連携
   ↓
5. PageModel
   ↓
6. 基本UI (HTML)
   ↓
7. JavaScript (拡張機能)
   ↓
8. CSS (スタイリング)
   ↓
9. テスト
   ↓
10. コンテナ化
```

---

## チェックリスト使用方法

### 開発中
各機能の実装が完了したら、該当する項目を以下のようにマークしてください：

```markdown
- [x] 完了した機能
- [ ] 未完了の機能
```

### レビュー時
各フェーズの完了時に、以下を確認してください：

1. ✅ すべてのチェックボックスが完了している
2. ✅ 単体テストが通過している
3. ✅ エラーが発生していない
4. ✅ ドキュメントが更新されている

---

## 拡張機能（将来実装）

### バッチ処理
- [ ] 複数画像の一括アップロード
- [ ] ZIP圧縮ファイルのアップロード
- [ ] 処理結果の一括ダウンロード
- [ ] バックグラウンドジョブの実装

### データ永続化
- [ ] データベースの統合
- [ ] 処理履歴の保存
- [ ] ユーザーアカウント管理
- [ ] 結果の検索機能

### 高度なOCR機能
- [ ] テーブル認識
- [ ] フォーム認識
- [ ] レイアウト解析
- [ ] 領域指定OCR

### エクスポート機能
- [ ] テキストファイル出力
- [ ] JSON/XML エクスポート
- [ ] PDF注釈追加
- [ ] Excel出力

### API化
- [ ] RESTful API の公開
- [ ] Swagger/OpenAPI ドキュメント
- [ ] APIキー認証
- [ ] レート制限

### 多言語対応
- [ ] UI の多言語化（i18n）
- [ ] 言語設定の保存
- [ ] 複数言語のOCR同時処理

---

## 進捗管理

### 全体の進捗

- **フェーズ1-4 (MVP)**: 0/XX 完了
- **フェーズ5-7 (高優先)**: 0/XX 完了
- **フェーズ8-11 (中優先)**: 0/XX 完了
- **フェーズ12-15 (低優先)**: 0/XX 完了

### 開始日
- 未定

### 完了予定日
- MVP: 未定
- 完全版: 未定

---

## 備考

- このドキュメントは開発の進行に合わせて更新してください
- 各機能の実装詳細は [architecture.md](architecture.md) を参照してください
- 新しい機能や変更点があれば、このリストに追加してください
- 優先度は状況に応じて変更可能です

---

**最終更新日**: 2025年12月19日
